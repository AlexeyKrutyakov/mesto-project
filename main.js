(()=>{"use strict";var e=document.querySelector(".profile"),t=e.querySelector(".profile__name"),n=e.querySelector(".profile__text"),r=document.querySelector(".cards"),o=document.querySelector(".".concat("popup_type_edit-avatar")),c=document.querySelector(".".concat("popup_type_edit-profile")),a=document.querySelector(".".concat("popup_type_add-place")),i=document.forms["edit-avatar"],s=i.elements["avatar-image-input"],u=document.forms["profile-info"],l=u.elements["profile-name-input"],d=u.elements["profile-text-input"],f=document.forms["place-info"],m=f.elements["place-name-input"],p=f.elements["place-image-input"],v="form__submit",_=u.querySelector(".".concat(v)),h=i.querySelector(".".concat(v)),y=f.querySelector(".".concat(v)),E={formSelector:".form",inputSelector:".form__input",submitButtonSelector:".form__submit",inactiveBtnClass:"form__submit_inactive",inputErrorClass:"form__input_type_invalid"},b=document.querySelector("#card-template").content,S="card__like-button_active";function g(e,t,n,o,c,a){var i=function(e,t,n,r,o,c){var a=arguments.length>6&&void 0!==arguments[6]?arguments[6]:"",i=b.querySelector(".card").cloneNode(!0),s=i.querySelector(".card__name"),u=i.querySelector(".card__image"),l=i.querySelector(".card__like-button"),d=i.querySelector(".card__likes-number"),f=i.querySelector(".card__remove-button");return o&&f.classList.add("card__remove-button_hidden"),i.id=t,d.textContent=e,s.textContent=n,u.src=r,u.alt=""===a?"Изображение места "+n:a,c&&l.classList.add("card__like-button_active"),i}(e,t,n,o,c,a,arguments.length>6&&void 0!==arguments[6]?arguments[6]:"");r.prepend(i)}function k(e,t){e.querySelector(".card__likes-number").textContent=t}function L(e,t,n){t.validity.patternMismatch?t.setCustomValidity(t.dataset.errorMessage):t.setCustomValidity(""),t.validity.valid?function(e,t,n){var r=e.querySelector(".".concat(t.name,"-error"));t.classList.remove(n.inputErrorClass),r.textContent=""}(e,t,n):function(e,t,n,r){var o=e.querySelector(".".concat(t.name,"-error"));t.classList.add(r.inputErrorClass),o.textContent=n}(e,t,t.validationMessage,n)}function q(e,t,n){var r=e.querySelector(n.submitButtonSelector),o=n.inactiveBtnClass;t.some((function(e){return!e.validity.valid}))?(r.classList.add(o),r.disabled=!0):(r.classList.remove(o),r.disabled=!1)}var C="popup_opened",j=document.querySelector(".".concat("popup_type_enlarge-image")),x=j.querySelector(".popup__image"),P=j.querySelector(".popup__figcaption");function U(e){e.classList.add(C),document.addEventListener("keydown",V)}function T(e){document.removeEventListener("keydown",V),e.classList.remove(C)}function A(e){e.preventDefault(),function(e,t,n){var r="".concat(n.baseUrl,"/users/me"),o={method:"PATCH",headers:n.headers,body:JSON.stringify({name:e,about:t})};fetch(r,o).then((function(e){return e.ok?(J(_),e.json()):Promise.reject("Error: ".concat(e.status))})).then((function(e){J(_),G(e)})).catch((function(e){console.log("Error: ",e)}))}(l.value,d.value,I),document.removeEventListener("keydown",V),T(c)}function w(e){e.preventDefault(),function(e,t){var n="".concat(t.baseUrl,"/users/me/avatar"),r={method:"PATCH",headers:t.headers,body:JSON.stringify({avatar:e})};fetch(n,r).then((function(e){return e.ok?(J(h),e.json()):Promise.reject("Error: ".concat(e.status))})).then((function(e){J(h),M(e)})).catch((function(e){console.log("Error: ",e)}))}(s.value,I),i.reset(),T(o)}function D(e){e.preventDefault(),function(e,t,n){var r="".concat(n.baseUrl,"/cards"),o={method:"POST",headers:n.headers,body:JSON.stringify({name:e,link:t})};fetch(r,o).then((function(e){return e.ok?(J(y),e.json()):Promise.reject("Error: ".concat(e.status))})).then((function(n){J(y),g(n.likes.length,n._id,e,t,!1,!1)})).catch((function(e){return console.log("Error: ",e)}))}(m.value,p.value,I),f.reset(),T(a)}var B=document.querySelector(".profile__avatar-image"),N=document.querySelector(".profile__name"),O=document.querySelector(".profile__text");function J(e){var t=e.textContent;e.textContent="Сохранить"===t?"Сохранение...":"Сохранить"}function M(e){B.src=e.avatar}function G(e){N.textContent=e.name,O.textContent=e.about,M(e)}function H(e){var r=e.target.classList;if(r.contains("profile__edit-avatar-button")&&(U(o),o.addEventListener("click",H),i.addEventListener("submit",w)),r.contains("profile__edit-button")&&(U(c),l.value=t.textContent,d.value=n.textContent,L(u,l,E),L(u,d,E),q(u,[l,d],E),c.addEventListener("click",H),u.addEventListener("submit",A)),r.contains("profile__add-button")&&(U(a),f.reset(),L(f,m,E),L(f,p,E),q(f,[m,p],E),a.addEventListener("click",H),f.addEventListener("submit",D)),r.contains("card__image")&&function(e){var t=e.target.src,n=e.target.closest(".".concat("card")).querySelector(".".concat("card__name")).textContent;x.src=t,x.alt="Увеличенное изображение места "+n,P.textContent=n,j.addEventListener("click",H),U(j)}(e),r.contains("card__like-button")&&function(e){var t=e.target,n=t.classList,r=t.parentElement;Array.from(t.classList).includes(S)?function(e,t){var n="".concat(e.baseUrl,"/cards/likes/").concat(t.id),r={method:"DELETE",headers:e.headers};fetch(n,r).then((function(e){return e.ok?e.json():Promise.reject("Error: ".concat(e.status))})).then((function(e){k(t,e.likes.length)})).catch((function(e){console.log("Error: ",e)}))}(I,r):function(e,t){var n="".concat(e.baseUrl,"/cards/likes/").concat(t.id),r={method:"PUT",headers:e.headers};fetch(n,r).then((function(e){return e.ok?e.json():Promise.reject("Error: ".concat(e.status))})).then((function(e){k(t,e.likes.length)})).catch((function(e){console.log("Error: ",e)}))}(I,r),n.toggle(S)}(e),r.contains("card__remove-button")&&function(e,t){var n=e.target.closest(".card"),r=n.id,o="".concat(t.baseUrl,"/cards/").concat(r),c={method:"DELETE",headers:t.headers};fetch(o,c).then((function(e){if(e.ok)return e.json()})).then((function(e){"Пост удалён"===e.message&&n.remove()})).catch((function(e){console.log("Error: ",e)}))}(e,I),r.contains("popup__close-button")){var s=e.target.closest(".popup");s.removeEventListener("click",H),T(s)}if(r.contains(v))switch(e.target.closest(".form").name){case"edit-avatar":o.removeEventListener("click",H),i.removeEventListener("submit",w),w(e);break;case"profile-info":c.removeEventListener("click",H),u.removeEventListener("submit",A),A(e);break;case"place-info":a.removeEventListener("click",H),f.removeEventListener("submit",D),D(e)}r.contains("popup")&&!r.contains("popup__container")&&T(e.target.closest(".popup"))}function V(e){if("Escape"===e.key){var t=document.querySelector(".popup_opened");t&&T(t)}}var z,F="d7fd7ac4dab38fe4557cfe28",I={baseUrl:"https://nomoreparties.co/v1/plus-cohort-24",headers:{authorization:"9e2d263a-3d5a-40f2-a16e-27e8711676de","Content-Type":"application/json"}},K=document.querySelector(".profile");!function(e){var t="".concat(e.baseUrl,"/users/me"),n={method:"GET",headers:e.headers};fetch(t,n).then((function(e){return e.ok?e.json():Promise.reject("Error: ".concat(e.status))})).then((function(e){F=e._id,G(e)})).catch((function(e){console.log("Error: ",e)}))}(I),function(e){var t="".concat(e.baseUrl,"/cards"),n={method:"GET",headers:e.headers};fetch(t,n).then((function(e){return e.ok?e.json():Promise.reject("Error: ".concat(e.status))})).then((function(e){e.forEach((function(e){var t,n,r;t=e.owner._id!==F,g(e.likes.length,e._id,e.name,e.link,t,(n=F,r=!1,e.likes.forEach((function(e){e._id===n&&(r=!0)})),r),e.alt)}))})).catch((function(e){console.log("Error: ",e)}))}(I),K.addEventListener("click",H),r.addEventListener("click",H),z=E,document.querySelectorAll(z.formSelector).forEach((function(e){var t=Array.from(e.querySelectorAll(z.inputSelector));q(e,t,z),t.forEach((function(n){n.addEventListener("input",(function(){L(e,n,z),q(e,t,z)}))}))}))})();