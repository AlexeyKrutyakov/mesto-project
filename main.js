(()=>{"use strict";var t={d:(e,n)=>{for(var r in n)t.o(n,r)&&!t.o(e,r)&&Object.defineProperty(e,r,{enumerable:!0,get:n[r]})},o:(t,e)=>Object.prototype.hasOwnProperty.call(t,e)};t.d({},{aS:()=>it,OJ:()=>ot,VO:()=>at});var e="popup",n="popup_opened",r="form__submit",c=document.querySelector(".profile"),o=document.querySelector(".".concat("profile__avatar-image")),a=document.querySelector(".".concat("profile__edit-avatar-button")),i=document.querySelector(".".concat("popup_type_edit-avatar")),u=document.forms["edit-avatar"],l=u.elements["avatar-image-input"],s=u.querySelector(".".concat(r)),d=c.querySelector(".".concat("profile__edit-button")),f=c.querySelector(".profile__name"),m=c.querySelector(".profile__text"),p=c.querySelector(".".concat("profile__add-button")),v=document.querySelector(".".concat("popup_type_edit-profile")),h=document.forms["profile-info"],y=h.elements["profile-name-input"],_=h.elements["profile-text-input"],b=h.querySelector(".".concat(r)),S=document.querySelector(".cards"),g="card",E="card__name",q="card__like-button_active",L=document.querySelector(".".concat("popup_type_add-place")),k=document.forms["place-info"],C=k.elements["place-name-input"],x=k.elements["place-image-input"],A=k.querySelector(".".concat(r)),O=document.querySelector(".".concat("popup_type_enlarge-image")),U=O.querySelector(".popup__image"),j=O.querySelector(".popup__figcaption"),T={formSelector:".form",inputSelector:".form__input",submitButtonSelector:".form__submit",inactiveBtnClass:"form__submit_inactive",inputErrorClass:"form__input_type_invalid"},w="Сохранить",P="Сохранение...";function B(t,e,n){var r=t.querySelector(".".concat(e.name,"-error"));e.classList.remove(n.inputErrorClass),r.textContent=""}function D(t,e,n){var r=n.inactiveBtnClass;t.some((function(t){return!t.validity.valid}))?(e.classList.add(r),e.disabled=!0):(e.classList.remove(r),e.disabled=!1)}function J(t){t.classList.add(n),document.addEventListener("keydown",N),t.addEventListener("click",V)}function M(t){document.removeEventListener("keydown",N),t.removeEventListener("click",V),t.classList.remove(n)}function N(t){if("Escape"===t.key){var e=document.querySelector(".popup_opened");e&&M(e)}}var I="popup__close-button";function V(t){(t.target.classList.contains(e)||t.target.classList.contains(I))&&M(t.target.closest(".".concat(e)))}function G(t,e){t.textContent=e}function H(t){t.classList.add(T.inactiveBtnClass)}function z(t){console.log(t)}var $={baseUrl:"https://nomoreparties.co/v1/plus-cohort-24",headers:{authorization:"9e2d263a-3d5a-40f2-a16e-27e8711676de","Content-Type":"application/json"}};function F(t){return t.ok?t.json():Promise.reject("Error: ".concat(t.status))}var K=document.querySelector("#card-template").content;function Q(t,e,n,r,c,o){var a=arguments.length>6&&void 0!==arguments[6]?arguments[6]:"",i=K.querySelector(".card").cloneNode(!0),u=i.querySelector(".card__name"),l=i.querySelector(".card__image"),s=i.querySelector(".card__like-button"),d=i.querySelector(".card__likes-number"),f=i.querySelector(".card__remove-button");return c&&f.classList.add("card__remove-button_hidden"),i.setAttribute("data-id","".concat(e)),W(d,t),u.textContent=n,l.src=r,l.alt=""===a?"Изображение места "+n:a,o&&s.classList.add("card__like-button_active"),s.addEventListener("click",at),f.addEventListener("click",ot),l.addEventListener("click",it),i}function R(t){S.prepend(t)}function W(t,e){t.textContent=e}function X(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){var n=null==t?null:"undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(null!=n){var r,c,o,a,i=[],u=!0,l=!1;try{if(o=(n=n.call(t)).next,0===e){if(Object(n)!==n)return;u=!1}else for(;!(u=(r=o.call(n)).done)&&(i.push(r.value),i.length!==e);u=!0);}catch(t){l=!0,c=t}finally{try{if(!u&&null!=n.return&&(a=n.return(),Object(a)!==a))return}finally{if(l)throw c}}return i}}(t,e)||function(t,e){if(t){if("string"==typeof t)return Y(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?Y(t,e):void 0}}(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function Y(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}var Z,tt,et,nt="";function rt(t,e){f.textContent=t,m.textContent=e}function ct(t){o.src=t}function ot(t){var e=t.target.closest(".card");(function(t){var e=t.dataset.id,n="".concat($.baseUrl,"/cards/").concat(e),r={method:"DELETE",headers:$.headers};return fetch(n,r).then((function(t){return F(t)})).catch((function(t){z(t)}))})(e).then((function(t){"Пост удалён"===t.message&&e.remove()})).catch((function(t){z(t)}))}function at(t){var e=t.target,n=e.closest(".".concat(g)),r=n.querySelector(".card__likes-number");e.classList.contains(q)?function(t){var e="".concat($.baseUrl,"/cards/likes/").concat(t.dataset.id),n={method:"DELETE",headers:$.headers};return fetch(e,n).then((function(t){return F(t)})).catch((function(t){z(t)}))}(n).then((function(t){e.classList.remove(q),W(r,t.likes.length)})).catch((function(t){return z(t)})):function(t){var e="".concat($.baseUrl,"/cards/likes/").concat(t.dataset.id),n={method:"PUT",headers:$.headers};return fetch(e,n).then((function(t){return F(t)})).catch((function(t){z(t)}))}(n).then((function(t){e.classList.add(q),W(r,t.likes.length)})).catch((function(t){return z(t)}))}function it(t){var e=t.target.src,n=t.target.closest(".".concat(g)).querySelector(".".concat(E)).textContent;U.src=e,U.alt="Увеличенное изображение места "+n,j.textContent=n,J(O)}Z=T,document.querySelectorAll(Z.formSelector).forEach((function(t){var e=Array.from(t.querySelectorAll(Z.inputSelector)),n=t.querySelector(Z.submitButtonSelector);D(e,n,Z),e.forEach((function(r){r.addEventListener("input",(function(){!function(t,e,n){e.validity.patternMismatch?e.setCustomValidity(e.dataset.errorMessage):e.setCustomValidity(""),e.validity.valid?B(t,e,n):function(t,e,n,r){var c=t.querySelector(".".concat(e.name,"-error"));e.classList.add(r.inputErrorClass),c.textContent=n}(t,e,e.validationMessage,n)}(t,r,Z),D(e,n,Z)}))}))})),Promise.all([(tt="".concat($.baseUrl,"/users/me"),et={method:"GET",headers:$.headers},fetch(tt,et).then((function(t){return F(t)})).catch((function(t){z(t)}))),function(){var t="".concat($.baseUrl,"/cards"),e={method:"GET",headers:$.headers};return fetch(t,e).then((function(t){return F(t)})).catch((function(t){z(t)}))}()]).then((function(t){var e=X(t,2),n=e[0],r=e[1];nt=n._id,rt(n.name,n.about),ct(n.avatar),r.forEach((function(t){var e=!function(t,e){return t.owner._id===e}(t,nt),n=function(t,e){return t.likes.some((function(t){return t._id===e}))}(t,nt);R(Q(t.likes.length,t._id,t.name,t.link,e,n,t.alt))}))})).catch((function(t){var e=X(t,2),n=e[0],r=e[1];console.log("Error: ",n),console.log("Error: ",r)})),a.addEventListener("click",(function(){u.reset(),H(s),B(u,l,T),J(i)})),d.addEventListener("click",(function(){var t;J(v),(t=h).querySelectorAll(T.inputSelector).forEach((function(e){B(t,e,T)})),y.value=f.textContent,_.value=m.textContent,b.classList.remove(T.inactiveBtnClass)})),p.addEventListener("click",(function(){k.reset(),B(k,C,x),H(A),J(L)})),u.addEventListener("submit",(function(t){t.preventDefault(),G(s,P),function(t){var e="".concat($.baseUrl,"/users/me/avatar"),n={method:"PATCH",headers:$.headers,body:JSON.stringify({avatar:t})};return fetch(e,n).then((function(t){return F(t)})).catch((function(t){z(t)}))}(l.value).then((function(t){ct(t.avatar),M(i)})).catch((function(t){z(t)})).finally((function(){G(s,w)}))})),h.addEventListener("submit",(function(t){t.preventDefault(),G(b,P),function(t,e){var n="".concat($.baseUrl,"/users/me"),r={method:"PATCH",headers:$.headers,body:JSON.stringify({name:t,about:e})};return fetch(n,r).then((function(t){return F(t)})).catch((function(t){z(t)}))}(y.value,_.value).then((function(t){rt(t.name,t.about),M(v)})).catch((function(t){z(t)})).finally((function(){G(b,w)}))})),k.addEventListener("submit",(function(t){t.preventDefault(),G(A,P),function(t,e){var n="".concat($.baseUrl,"/cards"),r={method:"POST",headers:$.headers,body:JSON.stringify({name:t,link:e})};return fetch(n,r).then((function(t){return F(t)})).catch((function(t){z(t)}))}(C.value,x.value).then((function(t){R(Q(t.likes.length,t._id,t.name,t.link,!1,!1)),M(L)})).catch((function(t){z(t)})).finally((function(){G(A,w)}))}))})();